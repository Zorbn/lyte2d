API code generation (take 2)